
# 正确的权重计算方法 - 总结

## 🎯 两种科学方法

在量化投资中，要避免过拟合（Overfitting）和运气成分，我们应当使用更科学、更经得起推敲的方法来确定策略参数。以下是两种推荐的方案：

| 方法 | 复杂度 | 耗时 | 可信度 | 推荐场景 |
| :--- | :--- | :--- | :--- | :--- |
| **方法1：相关性统计** | ⭐ 简单 | 5分钟 | ⭐⭐⭐⭐ | 快速验证想法，寻找因子的预测力 |
| **方法2：严格优化** | ⭐⭐⭐ 中等 | 10分钟+ | ⭐⭐⭐⭐⭐ | 正式上线前，确保策略在新数据上依然有效 |

---

### 方法1：相关性统计 (Correlation Analysis)

**核心思想**：
如果某个周期（例如 10日涨幅）对未来收益有预测作用，那么它的涨幅应该与未来的涨幅存在显著的**正相关**（或反转策略的负相关）。

**实施步骤**：
1. 计算过去 N 年所有股票的 1~20 日历史涨幅。
2. 计算对应的**未来 20 日涨幅**。
3. 计算每个周期涨幅与未来涨幅的 **IC (Information Coefficient, 信息系数)**，即 Spearman 秩相关系数。
4. **结论**：
    * IC > 0.05：显著正相关（动量因子）。权重设为正。
    * IC < -0.05：显著负相关（反转因子）。权重设为负。
    * |IC| < 0.02：无相关性。权重设为 0。
    * **权重分配**：权重大小直接与 IC 值成正比。

---

### 方法2：严格优化 (Train/Test Split Optimization)

**核心思想**：
为了防止“事后诸葛亮”，我们必须把数据切分为**训练集**和**测试集**。AI 只能在训练集上学习规律，然后在从未见过的测试集上验证效果。

**实施步骤**：
1. **数据切分**：
    * **训练集 (Training Set)**：前 70% 的时间段（例如 2021-2024）。用于 AI 寻找最佳权重。
    * **测试集 (Test Set)**：后 30% 的时间段（例如 2024-2026）。用于验证 AI 找出的权重是否真的有效。
2. **目标函数**：在训练集上最大化夏普比率或信息比率。
3. **样本外检验**：
    * 将训练好的权重应用到测试集。
    * 如果测试集上的表现大幅下降（例如收益减半），说明策略**过拟合**，不可用。
    * 如果测试集表现依然稳健，说明策略具有真实的预测力。

---

## ⚠️ 原报告的潜在风险 (Why current report is risky)

您之前的优化报告虽然展示了极高的收益，但存在以下风险点，需警惕：

1.  **全样本训练**：使用了从 2024.9 到 2026.2 的全部数据进行训练。这意味着 AI 已经“偷看”了答案（例如 9月底的牛市），它只是在背诵历史，而非学习规律。
2.  **过拟合风险**：20 个参数（1-20日权重）对于仅 1 年多的数据来说略显过多，容易捕捉到市场噪音。
3.  **缺乏显著性检验**：57% 的胜率在统计学上是否显著？如果是随机运气，也可能出现 57% 的胜率。需进行 T 检验。

## 🚀 下一步建议

建议立即运行随附的脚本：

1.  **运行 `scripts/simple_weight_calculator.py`**：
    * 快速查看 1~20 日涨幅与未来收益的真实相关性。这是最朴素、最不容易骗人的指标。

2.  **运行 `scripts/rigorous_weight_optimizer.py`**：
    * 使用严格的训练/测试集切分，重新评估策略的真实盈亏能力。
