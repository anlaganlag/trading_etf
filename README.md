# � ETF 滚动轮动策略：用户操作与技术手册 (main.py)

欢迎使用本策略。本策略专为 ETF 设计，其核心理念是 **“分散时间、严控回撤、顺势而为”**。

---

## 🛠 第一章：资金是怎么管理的？（10个水桶方案）

为了防止“一把梭”在错误的时间买入，策略将你的总本金平分为 **10 个独立的分仓 (Tranche)**。

### 📌 举例说明：
假设你有 **100 万** 本金：
1.  **分桶**：策略会自动将 100 万分成 10 份，每份 **10 万**。
2.  **滚动**：第 1 天操作第 1 桶，第 2 天操作第 2 桶……直到第 10 天操作第 10 桶。
3.  **循环**：第 11 天，再回到第 1 桶进行“卖旧买新”。
    *   **好处**：即便某一天市场暴跌，你当天也只处理 10% 的资金，其余 90% 的资金依然由止损系统保护，不会产生盲目的调仓。

---

## 🛡 第二章：如何保护你的本金？（双重安全气囊）

### 1. 个别 ETF 的“安全带” (Individual Guard)
每个分仓里的每一只 ETF 都有独立的生存检查：
*   **硬止损**：如果某只 ETF 从买入价下跌超过 **30%**，立刻清仓。
*   **追踪止盈**：
    *   只要 ETF 涨幅超过了 **15%**，安全按钮就会弹起。
    *   如果此时它从涨幅最高点回落了 **3%**，策略会果断反手卖出，锁定利润。

### 2. 个别 ETF 的“跳车检查” (Z-Score Gate)
策略会利用统计学 Z-Score 检查 ETF 的健康度。
*   **例子**：如果某只 ETF 最近 5 天跌得极不正常（跌幅超过了它往常波动的 1.6 倍），即便它的长期走势再好，策略也会认为它“结构性损坏”，**禁止买入**。

---

## ⚡ 第三章：Meta-Gate 风险状态机（系统性急刹车）

这是本策略最强大的功能。它不看单只股票，而是看**整个市场的“崩坏率” (Broken Ratio)**。

### 📌 场景模拟：
想象森林里有 100 棵树（代表 100 只 ETF）：
1.  **安全区 (SAFE)**：只有不到 40 棵树在剧烈摇晃，策略认为环境安全，正常交易。
2.  **警示区 (CAUTION)**：如果超过 **40 棵** 树在剧烈摇晃，策略进入警戒，减慢买入速度。
3.  **危险区 (DANGER)**：如果超过 **60 棵** 树在剧烈摇晃，说明“森林大火”或“地震”来了。
    *   **动作**：策略会触发 **“系统急刹车”**，立刻停止所有买入操作，进入强制空仓或防御状态。
    *   **恢复**：只有当摇晃的树木重新减少到 30 棵以下，才会解除警报。

---

## 📈 第四章：我们如何挑选 ETF？（评分引擎）

策略每天会给白名单里的所有 ETF 打分，选出最强的 **4 只**。

### 评分秘籍 (Weights)：
*   **20日表现 (权重 150)**：找到一个月内的“真趋势”。
*   **1日表现 (权重 30)**：捕捉当下的“强惯性”。
*   **3日表现 (权重 -70)**：**这是关键！** 我们给涨得太急的 ETF 扣分。
    *   **逻辑**：防止买在 3 天暴涨后的“尖顶”上，利用反转效应寻求更稳健的切入点。

---

## 🕒 第五章：每日操作指南

作为用户，你只需要在 **每个交易日的 14:55** 观察一下：

    *   **卖出**：先处理止损和到期需要换仓的 ETF。
    *   **买入**：根据 Meta-Gate 给出的“仓位额度”，买入新的领头羊。
    *   **不等权分配**：排名 **前 3** 的标的会分配 **2 倍** 资金，第 4 名分配 1 倍资金。

---

## 📝 总结

`main.py` 不仅仅是一个买卖工具，它是一个**具备“防御本能”的资管机器人**。它通过：
1.  **10分仓滚动** 抹平时间波动；
2.  **Z-Score** 过滤结构性崩盘风险；
3.  **Meta-Gate** 阻断系统性大跌；
4.  **动量反转评分** 寻找最舒适的盈利区间。

**交付建议**：请确保 `.json` 状态文件与脚本在同一目录下，策略会通过它记录你那“10个水桶”的详细情况。


## 附录


Z-Score 就是看一件事 “有多不正常”。
下面我用最通俗、最生活化的方式讲一遍，你马上就能懂。
1. 先想一个你熟悉的例子：身高
假设你们班同学的平均身高是 150 cm，大多数人都在 140～160 之间波动。
小明：150 cm → 很正常
小红：140 cm → 有点矮，但还正常
小刚：160 cm → 有点高，但也正常
突然来了个同学：210 cm
你第一反应是什么？→ 这也太不正常了吧！
Z-Score 就是把 “太不正常” 这件事，用一个数字表示出来。
2. Z-Score 到底算的是什么？
Z-Score 的公式可以简化成：
Z = (你现在的值 − 平均值) ÷ 标准差
你不用记公式，只要记住它的意思：
Z 告诉你：这件事离 “正常水平” 有多远，用 “波动幅度” 来衡量。
Z = 0：完全正常，和平均值一样
Z = 1：比平均值高 1 个 “波动幅度”
Z = -1：比平均值低 1 个 “波动幅度”
Z = 2：高得有点离谱
Z = -2：低得有点离谱
Z = 3 或 -3：非常非常不正常，属于极端情况
3. 回到 ETF 的 “跳车检查”
你说的策略是：
最近 5 天跌得极不正常（跌幅超过它往常波动的 1.6 倍），就认为 ETF “结构性损坏”，禁止买入。
用 Z-Score 翻译一下：
先算这只 ETF 过去一段时间的 平均每天波动（比如过去 60 天、120 天）
再算它的 标准差（就是 “正常波动范围”）
看最近 5 天的跌幅，算一个 Z-Score
如果 Z-Score 小于 -1.6（跌得比正常波动低 1.6 倍以上）
→ 就判定：太不正常了，可能出大事了，别买
4. 用生活比喻再总结一次
你可以把 Z-Score 想象成：
平均值 = 平时的路
标准差 = 正常的车道宽度
Z-Score = 你现在偏离车道多远
Z = 0：在路中间，很安全
Z = ±1：稍微偏一点，还能接受
Z = ±1.6：已经偏出正常车道了，很危险
Z = ±3：直接冲出马路，要翻车了
ETF 的 Z-Score Gate 就是：一旦跌得太偏（Z <-1.6），就 “跳车” 或禁止上车，防止翻车。
5. 一句话 ELI12
Z-Score 就是一个 “不正常程度” 分数：
数字越大 / 越小，说明这件事越离谱、越极端。
在 ETF 里，就是用它判断：这只基金是不是跌得太不正常，可能要坏了。
