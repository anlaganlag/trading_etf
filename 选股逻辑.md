# 策略选股参数与逻辑总结

> 基于 `main.py` 运行日志及 `config.py`, `core/strategy.py`, `core/signal.py` 代码分析。

## 1. 核心选股参数 (Parameters)

这些参数主要定义在 `config.py` 中，并会在日志初始化行 (`Initializing Simple Strategy...`) 中体现。

| 参数名 | 当前值 | 说明 |
| :--- | :--- | :--- |
| **T (轮动周期)** | **10** | 每个仓位份额持有10个交易日 (Daily Rolling) |
| **TopN (持仓数量)** | **4** | 目标持有4只最好的ETF |
| **Buffer (缓冲区)** | **2** | 缓冲带大小。用于减少换手（详见下方逻辑） |
| **Min Score (最低分)** | **20** | 只有评分 >= 20 的标的才会被纳入候选 |
| **Max Per Theme** | **2** | 同一主题（如"科技"、"消费"）最多持有2只 |
| **Stop Loss (止损)** | **20%** | 固定止损比例 |
| **Trailing Stop (移动止损)** | **15% / 3%** | 盈利超过15%后，回撤3%触发止盈 |
| **Mode** | **SMOOTH** | 指采用了 "Soft Rotation" (软轮动/缓冲区) 模式 |

## 2. 选股与交易逻辑 (Logic)

策略采用 **“动量 + 短期反转”** 的评分模型，结合 **“软轮动”** 机制来构建投资组合。

### A. 评分模型 (Scoring)
*   **代码位置**：`core/signal.py` -> `get_ranking`

策略对白名单内的 ETF 计算综合评分，公式如下：

1.  **多因子打分 (加权排名法)**：
    *   **20日收益 (长期动量)**：权重 `150`。**越涨越买**。
    *   **1日收益 (即时爆发)**：权重 `30`。**越涨越买**。
    *   **3日收益 (短期反转)**：权重 `-70`。**越跌越买** (寻找3日回调的买点)。
    *   *计算方式：对收益率排名 (Rank 1最高)，排名靠前的获得更高比例的权重分。*
2.  **过滤条件 (Hard Filter)**：
    *   **Z-Score 熔断**：剔除 `5日收益率` 异常下跌的标的 (跌幅超过 `1.6 * 60日波动率`)。
    *   **最低分门槛**：剔除总分低于 `20` 分的标的。

### B. 组合构建 (Construction)
*   **代码位置**：`core/strategy.py` -> `algo`

1.  **排序与去重**：
    *   将通过筛选的 ETF 按分数从高到低排序。
    *   **同主题限制**：从上往下选，如果某主题已满 2 只，则跳过该主题的后续标的。
2.  **软轮动 (Soft Rotation) —— 核心逻辑**：
    *   目标是选出 Top 4 (`TopN`)。
    *   **防抖动机制**：检查**当前持仓**。如果当前持仓的 ETF 跌出了 Top 4，但仍在 **Top 6** (`TopN + Buffer`) 之内，则**保留持仓，不换股**。
    *   只有当持仓跌出 Top 6，或者被强制止损时，才会被卖出，并买入新的 Top 4 候选者。
3.  **资金分配**：
    *   排名靠前的 (Top 3) 权重通常为 2，靠后的权重为 1 (具体视代码 `weights` 逻辑，当前代码逻辑主要做等权或阶梯权重分配)。

### C. 风险控制 (Risk Overlay)
1.  **Meta-Gate (市场状态)**：
    *   根据全市场崩盘广度（Crash Breadth）判断市场状态 (`SAFE`, `CAUTION`, `DANGER`)。
    *   **DANGER** 状态下会空仓或极低仓位。
2.  **宏观风控**：
    *   如果创业板 (`SZSE.159915`) 跌破 120 日均线，且微观强势股比例低，则可能触发保护性空仓。

---

### 一句话总结

这是一个持有 **4只ETF**、每 **10天** 轮动一次的策略，它寻找 **“长期(20日)走牛但短期(3日)回调”** 的标的，并利用 **Top 6 缓冲区** 来防止因排名微小波动而产生频繁交易。