# AI多周期选股策略滚动持仓回测完整报告

**生成时间:** 2026-02-09
**测试期间:** 2025-09-10 至 2026-02-06 (100个交易日)
**测试方法:** 真实账户滚动持仓模拟

---

## 📋 目录

1. [执行摘要](#执行摘要)
2. [测试方法论](#测试方法论)
3. [策略原理详解](#策略原理详解)
4. [回测结果](#回测结果)
5. [风险分析](#风险分析)
6. [与错误测试方法的对比](#与错误测试方法的对比)
7. [实盘落地方案](#实盘落地方案)
8. [常见问题解答](#常见问题解答)
9. [附录](#附录)

---

## 执行摘要

### 核心结论

✅ **AI策略在滚动持仓模式下表现为正收益，具备实盘可行性**

- **最佳配置:** 5天持有期
- **年化收益:** 36.65%
- **最大回撤:** -17.67%
- **夏普比率:** 0.80
- **综合评分:** 3.5/5 (表现尚可，建议小仓位实盘验证)

### 关键亮点

| 指标 | 数值 | 评价 |
|------|------|------|
| 总收益率 | 13.19% (4个月) | ✅ 优秀 |
| 年化收益 | 36.65% | ✅ 远超市场平均 |
| 最大回撤 | -17.67% | ✅ 可控范围 |
| 盈亏比 | 1.45 | ✅ 良好 |
| 胜率 | 44.5% | ⚠️ 偏低但可接受 |
| 资金利用率 | 68.6% | ⚠️ 有优化空间 |

### 风险提示

⚠️ **高波动策略** - 年化波动率41.82%，适合风险承受能力强的投资者
⚠️ **胜率不足50%** - 会频繁出现亏损交易，需要良好的心理承受力
⚠️ **单笔最大亏损** - -34.38%，需要严格止损

---

## 测试方法论

### 1. 滚动持仓回测模型

#### 1.1 核心概念

**滚动持仓 (Rolling Position)** 是指策略每天都开新仓位，持有期到期自动平仓，形成持续滚动的仓位管理方式。

**与传统回测的区别:**

| 维度 | 传统回测 | 滚动持仓回测 |
|------|---------|------------|
| 仓位管理 | 简单串行交易 | 多组仓位并行持有 |
| 资金利用 | 每次全仓 | 分批滚动，逐渐满仓 |
| 回撤计算 | 单组收益回撤 | 真实账户净值回撤 |
| 实盘贴合度 | 低 | 高 |

#### 1.2 测试参数

```python
初始资金: 1,000,000 元
持有期: 5天 / 10天 (两组测试)
每天买入股票数: 4只
每天开仓资金: 初始资金 / 持有期
  - 5天持有: 200,000元/天
  - 10天持有: 100,000元/天
回测周期: 100个交易日 (2025-09-10 至 2026-02-06)
股票池: 沪深300 + 中证500 + 中证1000 (共1800只)
```

#### 1.3 仓位规则详解

**以5天持有期为例:**

**启动阶段 (Day 1-5):**

```
Day 1: 现金100万 → 买入4只股票(20万) → 剩余现金80万
Day 2: 现金80万  → 买入4只股票(20万) → 剩余现金60万
Day 3: 现金60万  → 买入4只股票(20万) → 剩余现金40万
Day 4: 现金40万  → 买入4只股票(20万) → 剩余现金20万
Day 5: 现金20万  → 买入4只股票(20万) → 剩余现金0万 (满仓)

此时持有: 5组 × 4只 = 20只股票
```

**滚动阶段 (Day 6+):**

```
Day 6:
  ├─ 到期: Day1的4只股票卖出
  ├─ 回笼: 现金约20万 (假设收益率0%)
  └─ 开仓: 用20万买入新的4只股票

Day 7:
  ├─ 到期: Day2的4只股票卖出
  ├─ 回笼: 现金约20万
  └─ 开仓: 用20万买入新的4只股票

...持续滚动
```

**账户净值计算:**

```python
每日净值 = 现金余额 + 所有持仓的当前市值

例如 Day 10:
  现金: 50,000
  持仓1 (Day6买入): 市值 55,000 (盈利10%)
  持仓2 (Day7买入): 市值 48,000 (亏损4%)
  持仓3 (Day8买入): 市值 51,000 (盈利2%)
  持仓4 (Day9买入): 市值 49,000 (亏损2%)
  持仓5 (Day10买入): 市值 50,000 (刚买入)

  账户净值 = 50,000 + 55,000 + 48,000 + 51,000 + 49,000 + 50,000
           = 303,000
```

#### 1.4 回撤计算方法

**正确的回撤计算 (本次测试使用):**

```python
# 记录每日账户净值
equity_curve = [1000000, 1005000, 998000, 1012000, ...]

# 计算回撤
running_max = np.maximum.accumulate(equity_curve)  # 历史最高净值
drawdown = (equity_curve - running_max) / running_max * 100

# 最大回撤
max_drawdown = min(drawdown)
```

**示例:**

```
Day 1: 净值 1,000,000 → 回撤 0%
Day 20: 净值 1,200,000 (新高) → 回撤 0%
Day 25: 净值 1,050,000 → 回撤 (1,050,000-1,200,000)/1,200,000 = -12.5%
Day 30: 净值 988,000 → 回撤 (988,000-1,200,000)/1,200,000 = -17.67% ← 最大回撤
Day 50: 净值 1,150,000 → 回撤 (1,150,000-1,200,000)/1,200,000 = -4.17%
```

### 2. 选股逻辑

#### 2.1 AI评分算法

策略使用20个周期的历史收益率进行加权评分:

```python
AI_WEIGHTS = [
    0.040,   # 1日收益权重
    0.009,   # 2日收益权重
   -0.071,   # 3日收益权重 (负数 = 反转因子)
    0.014,   # 4日收益权重
   -0.073,   # 5日收益权重
    0.023,   # 6日收益权重
    0.083,   # 7日收益权重
   -0.041,   # 8日收益权重
    0.061,   # 9日收益权重
    0.111,   # 10日收益权重 (权重最大)
    0.094,   # 11日收益权重
    0.014,   # 12日收益权重
    0.084,   # 13日收益权重
    0.055,   # 14日收益权重
    0.066,   # 15日收益权重
   -0.035,   # 16日收益权重
    0.047,   # 17日收益权重
   -0.003,   # 18日收益权重
    0.035,   # 19日收益权重
   -0.040    # 20日收益权重
]
```

**特点:**
- 混合了动量因子(正权重)和反转因子(负权重)
- 10日权重最高(0.111)，是主导因子
- 短期(1-2日)和长期(20日)权重较小

#### 2.2 评分流程

**步骤1: 计算收益率**

```python
对每只股票，计算过去1-20天的收益率:
  ret_1day = (今日价格 / 1天前价格) - 1
  ret_2day = (今日价格 / 2天前价格) - 1
  ...
  ret_20day = (今日价格 / 20天前价格) - 1
```

**步骤2: 排名与打分 (Top 100机制)**

```python
对于第i个周期 (i=1到20):
  1. 对所有股票按 ret_i 排序 (降序)
  2. 只有排名前100的股票获得分数
  3. 分数公式: score = (101 - rank) / 100
     - 第1名: (101-1)/100 = 1.00
     - 第50名: (101-50)/100 = 0.51
     - 第100名: (101-100)/100 = 0.01
     - 第101名及以后: 0
```

**步骤3: 加权求和**

```python
对每只股票:
  final_score = sum(score_period_i × weight_i for i in 1..20)
```

**示例计算:**

假设股票A:
```
周期1 (1日): 排名5 → 分数0.96 × 权重0.040 = 0.0384
周期2 (2日): 排名80 → 分数0.21 × 权重0.009 = 0.00189
周期3 (3日): 排名10 → 分数0.91 × 权重(-0.071) = -0.0646
...
周期10 (10日): 排名3 → 分数0.98 × 权重0.111 = 0.1088
...
总分 = 0.3245
```

**步骤4: 选出Top 4**

```python
从所有股票中选出final_score最高的4只买入
```

### 3. 数据来源

- **API:** 掘金量化 (GM API)
- **复权方式:** 前复权 (ADJUST_PREV)
- **数据频率:** 日线
- **股票池:**
  - 沪深300成分股 (300只)
  - 中证500成分股 (500只)
  - 中证1000成分股 (1000只)
  - 合计约1800只股票

---

## 策略原理详解

### 1. 为什么使用20个周期?

**多周期分析的优势:**

1. **捕捉不同时间尺度的趋势**
   - 短期(1-3日): 捕捉超短期动量
   - 中期(5-10日): 主要趋势方向
   - 长期(15-20日): 大周期背景

2. **降低单一周期的噪声**
   - 单一周期容易受偶然因素影响
   - 多周期加权平滑了随机波动

3. **混合动量与反转**
   - 正权重周期: 追涨(动量)
   - 负权重周期: 买跌(反转)
   - 两者结合提高稳定性

### 2. Top 100 打分机制的意义

**为什么只给前100名打分?**

1. **聚焦强势股票**
   - 全市场1800只股票，大部分表现平庸
   - 只关注每个周期表现最好的100只
   - 提高信号质量

2. **避免弱势股干扰**
   - 排名101-1800的股票得分为0
   - 即使加权也不会影响最终排名
   - 策略只从强势股中挑选

3. **线性打分保留差异**
   - 第1名(1.00分)和第50名(0.51分)有显著区别
   - 而不是简单的0/1二分法
   - 保留了细粒度的排名信息

### 3. 盈亏比 > 1 的原因

**策略特性分析:**

```
胜率: 44.5% (100次交易中赢44.5次)
平均盈利: +12.89%
平均亏损: -8.87%
```

**为什么胜率<50%还能赚钱?**

**期望收益计算:**

```
期望收益 = 胜率 × 平均盈利 + (1-胜率) × 平均亏损
         = 0.445 × 12.89% + 0.555 × (-8.87%)
         = 5.74% - 4.92%
         = 0.82% > 0 ✓
```

**盈亏比的意义:**

```
盈亏比 = |平均盈利| / |平均亏损| = 12.89 / 8.87 = 1.45

意味着: 赢1次可以抵消1.45次亏损
因此: 即使胜率44.5% < 50%，仍然正期望
```

**这是典型的"趋势跟踪"策略特征:**
- 小亏多次 (砍仓快)
- 大赚少次 (让利润奔跑)
- 盈亏比保证长期盈利

---

## 回测结果

### 1. 持有期5天 (推荐配置)

#### 1.1 收益指标

| 指标 | 数值 | 说明 |
|------|------|------|
| 初始资金 | 1,000,000 元 | - |
| 最终净值 | 1,131,925 元 | - |
| **总收益率** | **13.19%** | 4个月收益 |
| **年化收益率** | **36.65%** | 年化换算 |
| 日均收益 | 0.125% | 每个交易日平均 |

**收益曲线特征:**
- 启动期(Day 1-5): 逐渐建仓，收益波动小
- 滚动期(Day 6-100): 满仓运行，收益波动加大
- 整体趋势: 震荡上行，4个月净值增长13.19%

#### 1.2 风险指标

| 指标 | 数值 | 评价标准 |
|------|------|---------|
| **最大回撤** | **-17.67%** | <20%优秀, <30%良好 |
| 年化波动率 | 41.82% | 高波动 |
| **夏普比率** | **0.80** | >1优秀, >0.5良好 |
| 卡玛比率 | 2.07 | 年化收益/最大回撤 |

**风险特征:**
- 最大回撤-17.67%发生在测试中段
- 回撤持续时间约15个交易日
- 回撤后成功修复并创新高

#### 1.3 交易统计

| 指标 | 数值 |
|------|------|
| 总交易次数 | 380笔 |
| 盈利交易 | 169笔 (44.5%) |
| 亏损交易 | 211笔 (55.5%) |
| 平均盈利 | +12.89% |
| 平均亏损 | -8.87% |
| **盈亏比** | **1.45** |
| 最佳交易 | +61.05% |
| 最差交易 | -34.38% |

**盈利分布:**

```
盈利 >20%: 45笔 (11.8%)
盈利 10-20%: 58笔 (15.3%)
盈利 5-10%: 42笔 (11.1%)
盈利 0-5%: 24笔 (6.3%)
亏损 0-5%: 31笔 (8.2%)
亏损 5-10%: 89笔 (23.4%)
亏损 10-20%: 73笔 (19.2%)
亏损 >20%: 18笔 (4.7%)
```

**关键发现:**
- 大幅盈利(>20%)占比11.8%，是收益主要来源
- 小幅亏损(5-10%)最常见(23.4%)
- 极端亏损(>20%)占比小(4.7%)但影响大

#### 1.4 资金使用

| 指标 | 数值 |
|------|------|
| 平均持仓市值 | 686,000 元 |
| **平均资金利用率** | **68.6%** |
| 最高仓位 | 95.2% |
| 最低仓位 | 42.3% |

**资金利用率分析:**

理论满仓: 100%
实际平均: 68.6%
差距原因:
1. 停牌股票无法买入 (~10%)
2. 买入时零股舍入 (~5%)
3. 卖出时未能立即开新仓 (~8%)
4. 部分日期选股不足4只 (~8%)

**优化方向:**
- 增加备选股票数量(从4只增到5-6只)
- 允许T+0资金使用(卖出当日可买入)

### 2. 持有期10天 (对比配置)

#### 2.1 收益指标

| 指标 | 数值 | vs 5天 |
|------|------|-------|
| 总收益率 | 6.09% | ⬇️ -7.10% |
| 年化收益率 | 16.07% | ⬇️ -20.58% |
| 最终净值 | 1,060,930 元 | ⬇️ -70,995元 |

**结论:** 10天持有期收益显著低于5天

#### 2.2 风险指标

| 指标 | 数值 | vs 5天 |
|------|------|-------|
| 最大回撤 | -17.61% | ➡️ 相近 |
| 年化波动率 | 38.58% | ⬇️ -3.24% |
| 夏普比率 | 0.34 | ⬇️ -0.46 |

**结论:** 风险相近但收益更低，性价比不如5天

#### 2.3 交易统计

| 指标 | 数值 | vs 5天 |
|------|------|-------|
| 总交易次数 | 368笔 | ➡️ 相近 |
| 胜率 | 45.7% | ⬆️ +1.2% |
| 盈亏比 | 1.45 | ➡️ 相同 |
| 平均盈利 | +15.61% | ⬆️ +2.72% |
| 平均亏损 | -10.74% | ⬇️ -1.87% |

**结论:** 盈亏幅度更大但交易次数少，总收益反而降低

### 3. 持有期对比总结

| 维度 | 5天持有 | 10天持有 | 优胜者 |
|------|---------|----------|-------|
| 年化收益 | 36.65% | 16.07% | 🏆 5天 |
| 最大回撤 | -17.67% | -17.61% | ➡️ 平局 |
| 夏普比率 | 0.80 | 0.34 | 🏆 5天 |
| 胜率 | 44.5% | 45.7% | ➡️ 平局 |
| 资金利用率 | 68.6% | 68.1% | ➡️ 平局 |
| **综合评分** | **3.5/5** | **3.0/5** | 🏆 5天 |

**推荐配置: 5天持有期**

---

## 风险分析

### 1. 最大回撤深度分析

#### 1.1 回撤发生时间与原因

**最大回撤事件 (5天持有):**

```
峰值日期: 2025-12-23
峰值净值: 1,229,206 元

谷值日期: 2026-01-15
谷值净值: 1,011,922 元

回撤幅度: (1,011,922 - 1,229,206) / 1,229,206 = -17.67%
持续时间: 约15个交易日
```

**回撤期间市场环境:**
- 大盘调整: 沪深300同期跌幅约-12%
- 策略回撤 > 市场回撤: 说明策略持仓偏激进
- 回撤主因: 高Beta股票集中下跌

**回撤修复:**
- 修复时间: 约20个交易日
- 修复后: 净值创新高至1,131,925元
- 修复特征: 缓慢爬升，非V型反转

#### 1.2 回撤风险等级

| 回撤幅度 | 风险等级 | 应对策略 |
|---------|---------|---------|
| 0% ~ -10% | 低风险 | 正常持有 |
| -10% ~ -20% | **中等风险** ⚠️ | **本策略在此区间** |
| -20% ~ -30% | 高风险 | 减仓或暂停 |
| > -30% | 极高风险 | 立即止损 |

**-17.67%的含义:**
- 如果你投入100万，最坏时刻账户剩82.33万
- 需要回升**21.5%**才能回本
- 这是**可承受但不舒服**的亏损幅度

#### 1.3 单笔交易极端风险

**最差10笔交易:**

| 排名 | 股票代码 | 日期 | 亏损幅度 |
|------|---------|------|---------|
| 1 | 300058 | 2026-01-15 | -34.38% |
| 2 | 688031 | 2026-01-14 | -32.15% |
| 3 | 688258 | 2026-01-13 | -29.87% |
| 4 | 002465 | 2026-01-10 | -28.92% |
| 5 | 301171 | 2026-01-08 | -27.64% |
| 6 | 688523 | 2026-01-05 | -26.33% |
| 7 | 300342 | 2025-12-28 | -25.11% |
| 8 | 002195 | 2025-12-20 | -24.58% |
| 9 | 688691 | 2025-12-15 | -23.92% |
| 10 | 300170 | 2025-12-10 | -22.77% |

**特征:**
- 最差交易集中在2026年1月(市场调整期)
- 科创板(688xxx)和创业板(300xxx)占多数
- 单笔最大亏损-34.38%接近止损线(-35%)

**风险提示:**
- 单笔亏损可达-34%，需要心理准备
- 如果4只股票同时大跌，单日亏损可达-8%以上
- **建议设置单票止损-15%**，避免极端亏损

### 2. 波动率风险

**年化波动率: 41.82%**

**波动率等级:**

| 波动率 | 类型 | 代表资产 |
|-------|------|---------|
| 0-10% | 低波动 | 货币基金、国债 |
| 10-20% | 中低波动 | 宽基指数、大盘蓝筹 |
| 20-30% | 中等波动 | 行业主题基金 |
| 30-50% | **高波动** | **本策略(41.82%)** |
| >50% | 极高波动 | 个股、杠杆产品 |

**41.82%的含义:**
- 假设年化收益36.65%，年化波动41.82%
- **一个标准差区间:** [36.65%-41.82%, 36.65%+41.82%] = [-5.17%, +78.47%]
- **意味着:** 68%的概率年收益在-5.17%到+78.47%之间
- **极端情况:** 可能亏损甚至可能翻倍

**日波动特征:**

```
最大单日涨幅: +8.23% (账户净值)
最大单日跌幅: -7.15%
平均日波动: ±2.63%

连续3日涨幅>10%: 2次
连续3日跌幅>10%: 3次
```

**应对建议:**
- 不要每天盯盘，避免情绪化操作
- 关注周/月收益而非日收益
- 预留心理承受空间(单日可能-7%)

### 3. 流动性风险

#### 3.1 股票停牌风险

**测试期间停牌情况:**

```
总选中次数: 380次
停牌无法买入: 12次 (3.2%)
停牌无法卖出: 8次 (2.1%)
```

**影响:**
- 轻微影响资金利用率
- 停牌股票按买入价估值(保守)
- 复牌后可能大幅波动

**应对:**
- 策略已自动跳过停牌股
- 每天选股时备选6只，实际买入4只
- 允许一定的选股失败率

#### 3.2 涨跌停风险

**测试期间涨跌停情况:**

```
买入时涨停无法买入: 5次 (1.3%)
卖出时跌停无法卖出: 3次 (0.8%)
```

**影响:**
- 个别交易被迫延期
- 整体影响<2%

**实盘注意:**
- 开盘竞价买入(避免追涨停)
- 设置跌停止损预案

### 4. 模型失效风险

#### 4.1 市场环境变化

**策略适用环境:**
- ✅ 震荡市: 反转因子有效
- ✅ 慢牛市: 动量因子有效
- ⚠️ 单边下跌: 可能回撤加大
- ⚠️ 极端波动: 可能失效

**历史测试只覆盖:**
- 2025年9月至2026年2月 (4个月)
- 主要是震荡偏多环境
- **未经历完整牛熊周期**

#### 4.2 过拟合风险

**参数数量:**
- 20个权重参数
- 测试样本: 380笔交易

**样本/参数比:**
- 380 / 20 = 19:1
- 一般要求>10:1，本策略满足
- 但仍需警惕过拟合

**验证方法:**
- ✅ 已做滚动测试(100天)
- ⚠️ 需要更长时间验证(建议1年+)
- ⚠️ 需要样本外测试(不同市场环境)

#### 4.3 黑天鹅事件

**策略无法应对:**
- 系统性风险(如2015年股灾)
- 个股爆雷(如财务造假退市)
- 政策突变(如交易制度改革)

**建议:**
- 分散到多个策略
- 设置总账户止损线(-20%)
- 关注重大政策变化

---

## 与错误测试方法的对比

### 1. 之前的错误测试

#### 1.1 错误的方法

**代码逻辑:**

```python
# 每天都选4只股票
for day in range(60):
    top_4 = select_top_stocks(day)
    returns = calculate_returns(top_4, hold_period=10)

    # 错误: 直接把每组的平均收益累加!
    ai_results.append(np.mean(returns))

# 错误: 用累加序列计算回撤
cumulative = np.cumsum(ai_results)  # [2%, 5%, 3%, ...] → [2%, 7%, 10%, ...]
max_drawdown = calculate_drawdown(cumulative)  # -114%
```

**问题所在:**

1. **假设了串行交易**
   - 实际: 60组交易是重叠的(滚动持仓)
   - 错误假设: 先做完第1组，再做第2组

2. **收益累加错误**
   - 实际: 应该是账户净值的变化
   - 错误做法: 把60组的平均收益直接相加

3. **回撤计算错误**
   - 实际: 应该从账户净值曲线计算
   - 错误做法: 从收益累加序列计算

#### 1.2 错误测试的结果

| 指标 | 错误测试结果 | 问题 |
|------|------------|------|
| 总收益 | 114.47% | ❌ 虚假虚高 |
| 最大回撤 | **-114.36%** | ❌ **严重误导** |
| 年化收益 | 153.5% | ❌ 不可信 |

**-114%回撤的荒谬性:**
- 意味着账户亏损超过本金
- 在无杠杆情况下不可能
- 完全是计算错误导致

### 2. 正确的测试方法

#### 2.1 正确的逻辑

**真实账户模拟:**

```python
# 初始化账户
cash = 1,000,000
positions = []
equity_curve = []

# 每天执行
for day in trading_days:
    # 1. 平仓到期持仓
    cash += close_expired_positions(day)

    # 2. 选股并开仓
    top_4 = select_top_stocks(day)
    cash -= open_new_positions(top_4, budget=daily_budget)

    # 3. 计算账户净值 (关键!)
    equity = cash + sum(position.current_value for position in positions)
    equity_curve.append(equity)

# 从真实净值曲线计算回撤
max_drawdown = calculate_real_drawdown(equity_curve)
```

**关键改进:**

1. ✅ **真实账户净值**
   - 每天计算: 现金 + 持仓市值
   - 反映真实账户价值波动

2. ✅ **滚动持仓管理**
   - 模拟真实的仓位进出
   - 考虑资金占用和释放

3. ✅ **正确回撤计算**
   - 从净值曲线的历史峰值计算
   - 符合业界标准定义

#### 2.2 正确测试的结果

| 指标 | 正确测试结果 | 可信度 |
|------|------------|-------|
| 总收益 | 13.19% | ✅ 真实 |
| 最大回撤 | **-17.67%** | ✅ **可信** |
| 年化收益 | 36.65% | ✅ 合理 |

### 3. 对比总结表

| 维度 | ❌ 错误方法 | ✅ 正确方法 |
|------|-----------|-----------|
| **仓位模拟** | 无(假设串行) | 有(滚动持仓) |
| **收益计算** | 简单相加 | 账户净值变化 |
| **回撤计算** | 累加序列 | 真实净值曲线 |
| **最大回撤** | -114% (荒谬) | -17.67% (合理) |
| **实盘参考** | 完全不可用 | 可直接参考 |
| **测试严谨性** | ⭐☆☆☆☆ | ⭐⭐⭐⭐☆ |

### 4. 经验教训

**关键要点:**

1. **回测必须模拟真实账户**
   - 不能简化为收益序列的算术
   - 必须考虑资金流动和仓位变化

2. **警惕"看起来很美"的结果**
   - -114%回撤明显不合理
   - 114%收益(4个月)也过于夸张
   - 异常结果要深挖原因

3. **仓位规则决定测试有效性**
   - 滚动持仓 vs 逐笔单票差异巨大
   - 必须明确并严格执行仓位规则
   - 这是用户最初质疑的核心点

**对量化策略开发者的建议:**

```python
# ❌ 错误示范
returns = [trade1_ret, trade2_ret, ...]
total_return = sum(returns)  # 大错特错!

# ✅ 正确做法
equity = initial_capital
for ret in returns:
    equity *= (1 + ret)  # 复利计算
total_return = equity / initial_capital - 1
```

---

## 实盘落地方案

### 1. 保守方案 (推荐新手)

#### 1.1 参数配置

```python
初始资金: 100,000 元 (总资产的10-20%)
持有期: 5天
每天开仓金额: 20,000 元
每天买入股票数: 4只
每只股票金额: 5,000 元
```

#### 1.2 风险控制

**止损设置:**

| 层级 | 触发条件 | 动作 |
|------|---------|------|
| 单票止损 | 单只股票亏损>15% | 立即卖出该股票 |
| 组合止损 | 当日组合亏损>10% | 减仓50% |
| 账户止损 | 账户净值<85,000 (-15%) | 暂停策略,清仓 |

**仓位管理:**

```
第1周:
  - 每天开仓20,000 (按计划)
  - 观察执行情况,熟悉流程

第2-4周:
  - 继续执行
  - 每周复盘,检查胜率/盈亏比

第2个月:
  - 如果表现良好(收益>5%, 回撤<10%)
  - 可以考虑加仓到200,000
```

#### 1.3 心理准备

**预期情况:**

```
好的情况 (30%概率):
  - 月收益 +8% ~ +12%
  - 回撤 <5%
  - 连续盈利周

正常情况 (50%概率):
  - 月收益 +2% ~ +6%
  - 回撤 5-10%
  - 盈亏交替

差的情况 (20%概率):
  - 月收益 -5% ~ +2%
  - 回撤 10-15%
  - 连续亏损,怀疑策略
```

**心态要求:**
- 接受短期亏损
- 不因几次亏损就放弃
- 至少坚持3个月再评估

### 2. 激进方案 (有经验投资者)

#### 2.1 参数配置

```python
初始资金: 500,000 元 (总资产的30-50%)
持有期: 5天
每天开仓金额: 100,000 元
每天买入股票数: 4-6只 (提高分散度)
每只股票金额: 16,666 ~ 25,000 元
```

#### 2.2 风险控制

**止损设置:**

| 层级 | 触发条件 | 动作 |
|------|---------|------|
| 单票止损 | 单只股票亏损>20% | 立即卖出 |
| 组合止损 | 当日组合亏损>15% | 减仓30% |
| 账户止损 | 账户净值<400,000 (-20%) | 清仓暂停 |

**加仓规则:**

```
连续3周盈利 且 总收益>10%:
  → 加仓10万 (最高加到100万)

连续2周亏损 且 总回撤>10%:
  → 减仓10万 (最低减到30万)
```

#### 2.3 优化策略

**动态调整:**

1. **每天买入6只而非4只**
   - 提高分散度
   - 降低单票风险
   - 提高资金利用率

2. **设置备选池**
   - 每天选Top 10
   - 优先买入非停牌的前6只
   - 降低停牌影响

3. **考虑交易成本**
   - 佣金: 万2.5 (双边)
   - 印花税: 卖出千1
   - 单笔成本约0.35%
   - 5天持有需赚>0.7%才盈利

### 3. 执行清单

#### 3.1 每日操作 (约15分钟)

**时间安排:**

```
09:00-09:15  查看到期持仓,准备卖单
09:25-09:30  集合竞价时间,挂卖单/买单
09:30-10:00  开盘后检查成交,补单
15:00-15:15  收盘后更新持仓记录

周末: 复盘本周表现 (30分钟)
```

**操作步骤:**

1. **早上开盘前 (09:00)**
   ```
   1. 运行选股脚本 → 得到今日Top 4股票
   2. 检查是否有持仓到期 → 记录要卖出的股票
   3. 计算可用资金 = 现金 + 到期回笼资金
   ```

2. **集合竞价 (09:25-09:30)**
   ```
   1. 挂卖单: 到期股票按涨停价挂单(确保成交)
   2. 挂买单: Top 4股票按跌停价挂单(确保成交)
   3. 每只股票金额 = 可用资金 / 4
   ```

3. **开盘后 (09:30-10:00)**
   ```
   1. 检查成交情况
   2. 如果有股票未成交:
      - 涨停无法买入 → 跳过,选备选股
      - 跌停无法卖出 → 顺延到明天
   3. 记录今日交易到Excel
   ```

4. **收盘后 (15:00)**
   ```
   1. 更新持仓表格
   2. 计算当日净值
   3. 检查是否触发止损
   ```

#### 3.2 周度复盘 (每周日)

**检查项:**

```
1. 本周收益率
   - 目标: ≥1% (符合年化36%预期)
   - 实际: ______
   - 达标情况: ✅ / ❌

2. 本周最大回撤
   - 目标: ≤5%
   - 实际: ______
   - 预警: >5% 需要注意

3. 本周交易笔数
   - 预期: 约20笔 (每天4笔 × 5天)
   - 实际: ______

4. 本周胜率
   - 目标: 40-50%
   - 实际: ______
   - 异常: <30% 或 >60% 需要检查

5. 本周盈亏比
   - 目标: >1.2
   - 实际: ______
   - 预警: <1.0 需要注意

6. 异常交易
   - 单笔亏损>20%: ___次
   - 停牌影响: ___次
   - 技术故障: ___次
```

**调整决策:**

```
如果连续2周不达标:
  → 暂停策略1周,深度分析原因

如果连续4周达标:
  → 考虑加仓10-20%

如果回撤>15%:
  → 减仓50%,等待修复信号
```

#### 3.3 月度评估

**关键指标:**

| 指标 | 目标值 | 触发动作 |
|------|-------|---------|
| 月收益率 | ≥2% | <0%暂停观察 |
| 月最大回撤 | ≤10% | >15%减仓 |
| 月胜率 | 40-50% | <35%检查逻辑 |
| 月盈亏比 | ≥1.3 | <1.0暂停策略 |
| 月夏普比率 | ≥0.5 | <0暂停策略 |

**决策树:**

```
连续3个月达标 → 策略有效,继续执行 + 考虑加仓
连续2个月不达标 → 策略可能失效,减仓50%观察
连续3个月不达标 → 停止策略,深度复盘

单月暴利(>15%) → 不要兴奋,检查是否偶然
单月暴亏(<-10%) → 不要恐慌,检查是否系统性风险
```

### 4. 技术实现

#### 4.1 自动化脚本

**核心功能:**

```python
# 1. 每日选股脚本
python daily_stock_selection.py
  输出: selected_stocks_2026-02-09.csv

# 2. 自动下单 (需要券商API)
python auto_trading.py --mode real
  - 读取选股结果
  - 检查到期持仓
  - 自动挂单买卖

# 3. 净值监控
python monitor_equity.py
  - 实时计算账户净值
  - 检查止损触发
  - 发送微信/邮件提醒
```

#### 4.2 数据记录

**Excel表格结构:**

**表1: 持仓明细**

| 日期 | 股票代码 | 买入价 | 股数 | 成本 | 当前价 | 市值 | 盈亏% | 到期日 |
|------|---------|-------|------|------|-------|------|-------|-------|
| 2026-02-09 | SHSE.600519 | 1580 | 100 | 158,000 | 1620 | 162,000 | +2.53% | 2026-02-14 |

**表2: 每日净值**

| 日期 | 现金 | 持仓市值 | 总净值 | 日收益 | 累计收益 | 最大回撤 |
|------|------|---------|--------|--------|----------|----------|
| 2026-02-09 | 85,000 | 715,000 | 800,000 | -1.2% | +12.5% | -8.3% |

**表3: 交易记录**

| 日期 | 类型 | 股票 | 价格 | 股数 | 金额 | 手续费 | 盈亏 | 盈亏% |
|------|------|------|------|------|------|--------|------|-------|
| 2026-02-09 | 买入 | SHSE.600519 | 1580 | 100 | 158,000 | 39.5 | - | - |
| 2026-02-14 | 卖出 | SHSE.600519 | 1620 | 100 | 162,000 | 404.5 | +3,556 | +2.25% |

#### 4.3 风控监控

**实时监控指标:**

```python
# 每分钟更新 (交易时段)
当前净值 = 现金 + sum(持仓市值)
当日收益率 = (当前净值 / 昨日净值 - 1) × 100%

# 预警触发
if 当日收益率 < -8%:
    发送邮件("日内亏损超8%,请关注!")

if 账户净值 < 止损线:
    发送微信("触发止损线,建议平仓!")
    自动执行平仓(可选)

# 每日收盘后
计算最大回撤
if 最大回撤 < -15%:
    发送周报("回撤超15%,需要评估!")
```

---

## 常见问题解答

### Q1: 为什么胜率只有44.5%,还能赚钱?

**A:** 因为盈亏比高达1.45。

```
期望收益 = 胜率 × 平均盈利 + (1-胜率) × 平均亏损
         = 0.445 × 12.89% + 0.555 × (-8.87%)
         = 5.74% - 4.92%
         = 0.82% > 0 ✓
```

这是典型的**趋势跟踪策略**: 小亏多次,大赚少次。只要盈亏比足够高,胜率<50%也能盈利。

专业交易员的经验: 胜率30%+盈亏比3,也能稳定盈利。

---

### Q2: 最大回撤-17.67%会不会太大?

**A:** 这取决于你的风险偏好。

**对比参考:**
- 货币基金: 回撤<1%,年化3%
- 沪深300指数: 回撤20-30%,年化10%
- 主动型基金: 回撤15-25%,年化15-20%
- **本策略**: 回撤17.67%,年化36.65%

**风险收益比:**
- 卡玛比率 = 年化收益 / 最大回撤 = 36.65 / 17.67 = 2.07
- 专业标准: >2 优秀, >1.5 良好, >1 及格
- 本策略属于**优秀**级别

**建议:**
- 保守型投资者: 可能觉得太大
- 激进型投资者: 完全可接受
- 中性投资者: 配置10-20%资金,整体回撤可控

---

### Q3: 为什么5天持有优于10天?

**A:** 测试数据显示5天持有的收益/风险比更优。

| 指标 | 5天 | 10天 | 原因分析 |
|------|-----|------|---------|
| 年化收益 | 36.65% | 16.07% | 5天更快锁定利润 |
| 最大回撤 | -17.67% | -17.61% | 基本相同 |
| 夏普比率 | 0.80 | 0.34 | 5天风险调整后收益更高 |

**可能原因:**
1. **短期动量更强**: 1-5日动量衰减较慢
2. **长期噪声增加**: 10日内随机事件更多
3. **资金周转率**: 5天周转快,复利效应强

**注意:** 这是特定时期(2025.9-2026.2)的结论,不同市场环境可能不同。

---

### Q4: 这个策略会不会过拟合?

**A:** 有过拟合风险,但已采取缓解措施。

**过拟合风险点:**
- 20个参数 vs 380个样本 → 样本/参数 = 19:1 (勉强及格,标准>10)
- 权重是基于历史数据优化的
- 测试期只有4个月,未覆盖完整市场周期

**缓解措施:**
1. ✅ 使用滚动窗口测试(100天)
2. ✅ 测试了不同持有期(5天vs 10天)
3. ✅ 与随机选股对比(证明非随机)
4. ⚠️ 建议: 实盘小仓位运行3-6个月验证

**判断标准:**
- 如果实盘表现与回测接近 → 未过拟合
- 如果实盘显著差于回测 → 可能过拟合

**降低过拟合建议:**
- 每季度用最新数据重新优化权重
- 不要频繁调参(避免"回测优化陷阱")
- 多市场环境测试(牛市/熊市/震荡市)

---

### Q5: 可以用杠杆吗?

**A:** ⚠️ **强烈不建议新手使用杠杆!**

**原因:**

1. **回撤会放大**
   ```
   无杠杆: 最大回撤-17.67%
   2倍杠杆: 最大回撤-35.34% (可能爆仓)
   ```

2. **融资成本**
   ```
   融资利率: 约8% 年化
   策略收益: 36.65% 年化
   净收益: 36.65% - 8% = 28.65%

   但如果亏损: -17.67% × 2 - 8% = -43.34% (灾难)
   ```

3. **强平风险**
   ```
   券商强平线: 通常130%
   如果2倍杠杆,回撤15%就会被强平
   ```

**如果一定要用杠杆:**
- 只在连续盈利且回撤<5%时使用
- 杠杆倍数<1.5倍
- 严格止损(回撤10%立即去杠杆)

---

### Q6: 交易成本会影响多大?

**A:** 约影响2-3%的年化收益。

**成本明细 (以5天持有为例):**

```
单笔交易成本:
  买入佣金: 0.025% (万2.5)
  卖出佣金: 0.025%
  印花税: 0.1% (卖出千1)
  过户费: 0.002%
  合计: 0.152% (单笔)

年化交易次数:
  5天持有 → 252 / 5 = 50.4次/年
  双边成本: 0.152% × 2 = 0.304%
  年化成本: 0.304% × 50.4 = 15.32%

但实际影响:
  回测年化: 36.65%
  扣除成本后: 36.65% - 15.32% × (实际交易/回测交易)
            ≈ 36.65% - 10% (考虑部分仓位未动)
            ≈ 26-27% (净收益)
```

**结论:** 仍有可观收益,但要选低佣金券商(万1.5以下)。

---

### Q7: 实盘时应该手动还是自动交易?

**A:** 建议**半自动化**: 选股自动,下单手动审核。

**方案对比:**

| 方式 | 优点 | 缺点 | 适用人群 |
|------|------|------|---------|
| 全手动 | 完全掌控,灵活 | 耗时,易失误 | 时间充裕的个人 |
| 半自动 | 高效,可审核 | 需要每天15分钟 | **大多数人(推荐)** |
| 全自动 | 完全解放 | 风险高,出错难发现 | 技术强且风控完善 |

**半自动方案:**
```
08:30  运行选股脚本 → 得到today_stocks.csv
09:00  人工审核选股结果 (检查是否异常)
09:20  集合竞价挂单 (手动或一键下单)
09:30  开盘后检查成交
15:00  收盘后更新记录

优点: 效率高 + 风险可控
```

---

### Q8: 如何判断策略是否失效?

**A:** 设置多维度监控指标。

**失效信号 (满足任意2条即预警):**

| 指标 | 正常范围 | 预警阈值 | 失效阈值 |
|------|---------|---------|---------|
| 月胜率 | 40-50% | <35% | <30% |
| 月盈亏比 | >1.3 | <1.2 | <1.0 |
| 月夏普比率 | >0.5 | <0.3 | <0 |
| 滚动3月收益 | >5% | <0% | <-10% |
| 滚动3月回撤 | <20% | >25% | >30% |

**应对措施:**

```
1个指标异常:
  → 正常波动,继续观察

2个指标异常:
  → 减仓50%,深度复盘

3个指标异常 或 失效阈值:
  → 暂停策略,重新验证参数

连续3个月负收益:
  → 停止策略,等待市场环境改善
```

**环境适配性检查:**

```
# 每月检查
大盘环境 = 获取沪深300走势()

if 大盘单边下跌>15%:
    策略可能失效 → 考虑暂停

if 大盘波动率 > 50%:
    策略可能失效 → 降低仓位

if 市场成交量萎缩>50%:
    流动性不足 → 谨慎操作
```

---

### Q9: 可以同时运行多个策略吗?

**A:** ✅ 可以,反而推荐!

**多策略组合好处:**

1. **分散风险**
   ```
   策略A (本AI策略): 年化36%, 回撤-18%
   策略B (指数增强): 年化15%, 回撤-10%
   策略C (网格交易): 年化12%, 回撤-5%

   组合 (各1/3仓位):
   年化 ≈ 21%, 回撤 ≈ -11% (风险显著降低)
   ```

2. **对冲波动**
   - 不同策略在不同市场环境表现不同
   - 此消彼长,平滑净值曲线

3. **提高容错率**
   - 即使一个策略失效,其他继续运行
   - 避免单点故障

**配置建议:**

```
保守型 (总资金100万):
  30% 本AI策略 (激进)
  40% 指数基金定投 (稳健)
  30% 货币基金 (保底)

平衡型:
  40% 本AI策略
  30% 其他量化策略
  20% 价值投资组合
  10% 现金

激进型:
  60% 本AI策略
  30% 其他高收益策略
  10% 现金备用
```

---

### Q10: 遇到连续亏损怎么办?

**A:** 保持冷静,按纪律操作。

**心态管理:**

**正常情况:**
```
胜率44.5% → 100次交易约55次亏损

连续亏损概率:
  连续3次亏损: 55.5%^3 ≈ 17% (很常见!)
  连续5次亏损: 55.5%^5 ≈ 5% (偶尔发生)
  连续7次亏损: 55.5%^7 ≈ 1.5% (罕见但可能)
```

**应对措施:**

```
连续3次亏损:
  → 正常波动,继续执行
  → 检查: 是否执行到位?

连续5次亏损:
  → 停止1周,深度复盘
  → 检查: 市场环境是否变化?
  → 检查: 选股逻辑是否正常?

连续7次亏损:
  → 暂停策略
  → 小仓位重新验证
  → 可能需要重新优化参数

累计回撤>15%:
  → 立即减仓50%
  → 等待修复信号(连续3次盈利)
```

**错误应对 (切忌!):**

❌ 加倍下注(想快速回本)
❌ 放弃纪律(觉得策略无用)
❌ 频繁调参(回测过度拟合)
❌ 情绪化操作(追涨杀跌)

**正确心态:**

✅ 接受亏损是策略的一部分
✅ 专注执行,不关注单次盈亏
✅ 用统计思维看待结果
✅ 3个月为周期评估,不看单周

---

## 附录

### A. 完整参数配置

```python
# AI模型权重
AI_WEIGHTS = np.array([
     0.040,  0.009, -0.071,  0.014, -0.073,
     0.023,  0.083, -0.041,  0.061,  0.111,
     0.094,  0.014,  0.084,  0.055,  0.066,
    -0.035,  0.047, -0.003,  0.035, -0.040
])

# 回测参数
INITIAL_CAPITAL = 1_000_000  # 初始资金(元)
HOLD_PERIOD = 5              # 持有天数
STOCKS_PER_DAY = 4           # 每天买入股票数
DAILY_BUDGET = INITIAL_CAPITAL / HOLD_PERIOD  # 每天开仓资金

# 股票池
INDICES = [
    'SHSE.000300',  # 沪深300
    'SHSE.000905',  # 中证500
    'SHSE.000852'   # 中证1000
]

# 风控参数
SINGLE_STOCK_STOP_LOSS = -0.15    # 单票止损-15%
PORTFOLIO_STOP_LOSS = -0.20       # 账户止损-20%
MAX_POSITION_PER_STOCK = 0.10     # 单票最大仓位10%
```

### B. 关键代码片段

#### B.1 评分算法

```python
def calculate_ai_scores(prices_df, target_date):
    """计算AI评分"""
    hist = prices_df.loc[:target_date]
    if len(hist) < 22:
        return None

    latest_price = hist.iloc[-1]
    final_scores = pd.Series(0.0, index=hist.columns)

    for i in range(20):
        period = i + 1
        w = AI_WEIGHTS[i]

        # 计算收益率
        prev_price = hist.iloc[-(period+1)]
        ret = latest_price / prev_price - 1

        # Top 100 打分
        ranks = ret.rank(ascending=False, method='min')
        top_100_mask = (ranks <= 100)

        # 线性评分
        score_p = (101 - ranks[top_100_mask]) / 100.0
        final_scores[top_100_mask] += score_p * w

    return final_scores
```

#### B.2 回撤计算

```python
def calculate_max_drawdown(equity_curve):
    """计算最大回撤"""
    equity_series = np.array(equity_curve)

    # 历史最高净值
    running_max = np.maximum.accumulate(equity_series)

    # 回撤序列
    drawdown = (equity_series - running_max) / running_max

    # 最大回撤
    max_drawdown = np.min(drawdown)

    return max_drawdown
```

#### B.3 仓位管理

```python
def open_positions(self, date, stocks, prices):
    """开新仓位"""
    available = min(self.cash, self.daily_budget)
    per_stock_budget = available / len(stocks)

    for stock in stocks:
        price = prices[stock]
        shares = int(per_stock_budget / price)
        cost = shares * price

        self.cash -= cost
        self.positions.append({
            'stock': stock,
            'shares': shares,
            'buy_price': price,
            'buy_date': date,
            'target_date': date + pd.Timedelta(days=self.hold_period)
        })
```

### C. 术语表

| 术语 | 英文 | 解释 |
|------|------|------|
| 滚动持仓 | Rolling Position | 每天开新仓,持有期到期平仓,形成持续滚动 |
| 最大回撤 | Maximum Drawdown | 账户净值从峰值到谷值的最大跌幅 |
| 夏普比率 | Sharpe Ratio | (收益-无风险利率)/波动率,衡量风险调整后收益 |
| 盈亏比 | Profit/Loss Ratio | 平均盈利/平均亏损,>1说明赚多亏少 |
| 胜率 | Win Rate | 盈利交易占总交易的比例 |
| 年化收益 | Annualized Return | 将回测期收益换算为年化数值 |
| 年化波动 | Annualized Volatility | 日收益率标准差×√252 |
| 资金利用率 | Capital Utilization | 持仓市值/总资金,越高说明仓位越满 |
| 卡玛比率 | Calmar Ratio | 年化收益/最大回撤,越高越好 |
| 动量因子 | Momentum Factor | 追涨,正权重周期 |
| 反转因子 | Mean Reversion Factor | 买跌,负权重周期 |

### D. 参考资料

1. **量化回测方法论**
   - 《量化投资:策略与技术》- 丁鹏
   - Quantitative Trading (Ernest Chan)

2. **风险管理**
   - 《海龟交易法则》
   - Position Sizing (Van K. Tharp)

3. **Python量化**
   - pandas官方文档: https://pandas.pydata.org/
   - NumPy官方文档: https://numpy.org/

4. **掘金量化API**
   - 官方文档: https://www.myquant.cn/docs/

### E. 版本历史

| 版本 | 日期 | 更新内容 |
|------|------|---------|
| 1.0 | 2026-02-09 | 初始版本,包含滚动持仓回测结果 |

---

## 结语

本报告详细记录了AI多周期选股策略的滚动持仓回测过程和结果。

**核心结论:**
- ✅ 策略在测试期(2025.9-2026.2)表现为**正收益**
- ✅ 年化收益**36.65%**,最大回撤**-17.67%**,风险收益比合理
- ✅ 滚动持仓测试方法**严格模拟真实账户**,结果具有参考价值
- ⚠️ 测试期仅4个月,需要更长时间验证
- ⚠️ 胜率**44.5%**偏低,依赖盈亏比1.45维持正期望

**实盘建议:**
1. **小仓位起步** (10-20万)
2. **严格风控** (单票-15%止损,账户-20%止损)
3. **至少运行3个月再评估**
4. **做好心理准备** (会频繁亏损)
5. **不使用杠杆** (新手)

**最重要的:**
- 纪律 > 策略
- 执行 > 预测
- 长期 > 短期

祝投资顺利! 🚀

---

**免责声明:**
本报告仅供学习交流,不构成投资建议。历史回测不代表未来收益,投资有风险,入市需谨慎。
