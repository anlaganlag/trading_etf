
# 实盘策略调整建议：拥抱“均值回归”

## 1. 核心发现总结

经过多轮的数据验证与 AI 训练，我们得出了一个与直觉相反但符合 A 股特征的重要结论：

*   **结论**：在当前的测试区间 (2024.9 - 2026.2) 内，市场呈现显著的**短期与中期反转 (Mean Reversion)** 特征，而非动量特征。
*   **证据**：
    *   **相关性分析**：1~20 日涨幅与未来 20 日收益均呈负相关，且周期越长（15-20日），负相关越强 (IC ≈ -0.03)。
    *   **AI 验证**：试图寻找复杂动量组合的模型在样本外失效，证实简单的追涨逻辑不可行。
    *   **推荐方案**：根据 `quick_reversion_recommendations.txt`，最佳策略是给予 **15-20日涨幅** 显著的 **负权重**。

## 2. 策略调整方向

我们应当放弃之前试图“精确预测每日权重”的复杂模型，转而使用稳健的 **“长周期反转 + 短期惯性”** 极简模型。

### 推荐参数 (基于方案3)
给予 15-20 日涨幅负分，意味着我们寻找的是：**长期没有过度透支（甚至有些超跌），但短期可能有启动迹象** 的股票。

$$ \text{Score} = \text{短期因子} - 0.3 \times \text{Rank}_{15} - 0.35 \times \text{Rank}_{18} - 0.36 \times \text{Rank}_{20} $$

*(注：保持 1 日涨幅为正权重作为“启动信号”通常是反转策略的有效补充)*

## 3. 代码修改建议

建议修改 `core/signal.py` 中的 `get_ranking` 函数。

### 修改前 (Core Signal Logic)
目前的逻辑主要侧重于 20 日动量 (权重 150) 和 1 日动量 (权重 30)。

### 修改后 (New Reversion Logic)
我们将 20 日动量改为**反转因子**（负分），或者大幅降低其权重，同时引入我们验证有效的 15-20 日反转权重。

```python
# core/signal.py 修改示例

def get_ranking(context, current_dt):
    # ... (前置代码不变) ...

    # === 修改部分开始 ===
    # 原始逻辑: periods = {1: 30, 3: -70, 20: 150} (20日是强动量)
    
    # 新逻辑: 引入经验证的反转因子
    # 策略思想: 
    # 1. Day 1: +30 (保持短期惯性/启动)
    # 2. Day 3: -50 (保持短期回调要求)
    # 3. Day 20: -40 (改为反转! 寻找补涨潜力股)
    
    scores = pd.Series(0.0, index=hist.columns)
    
    # 定义新权重字典
    # 依据: output/quick_reversion_recommendations.txt 方案1 & 3
    # 我们保留 Day 1 的正向启动信号，但将中长期改为反转
    periods_weights = {
        1: 30,    # 短期启动
        3: -50,   # 短期回调确认
        15: -20,  # 中期反转
        20: -30   # 长期反转 (避免追高)
    }
    
    rets = {f'r{p}': (last / hist.iloc[-(p+1)]) - 1 for p in [1, 3, 5, 15, 20]}

    for p, weight in periods_weights.items():
        # Rank 1 是涨幅最大的
        ranks = rets[f'r{p}'].rank(ascending=False, method='min')
        
        # 归一化排名 (0~1)
        # norm_rank = 1.0 (第一名) -> 0.0 (最后一名)
        norm_rank = (len(ranks) - ranks + 1) / len(ranks)
        
        # 加分: Score += NormRank * Weight
        # 如果 Weight 是负数 (如 -30)，涨幅第一名(1.0) 扣分最多 (-30)。
        # 涨幅最后一名(0.0) 扣分最少 (0)。
        scores += norm_rank * weight

    # ... (后续 Z-Score 熔断等逻辑保持不变) ...
```

## 4. 预期效果

通过此调整，策略将从 **“追逐已经大涨的龙头”** 转向 **“挖掘蓄势待发、近期回踩到位”** 的潜力股。这在震荡市和轮动较快的市场中（如当前 A 股）通常具有更高的胜率和盈亏比。

## 5. 执行计划

1.  **备份**：备份当前的 `core/signal.py`。
2.  **修改**：应用上述逻辑修改。
3.  **回测**：使用 `run_backtest.py` 在测试集 (2025.9 - 2026.2) 上验证新逻辑的效果。
